version: '3.7'

services:
  nextjs-app:
    # يخبر Docker Compose أن يقوم بالبناء باستخدام الـ Dockerfile الموجود في نفس المجلد (.).
    build: .
    # *تعديل مهم*: تم إزالة قسم ports لجعله داخليًا فقط.
    restart: always
    
  caddy:
    image: caddy:2-alpine
    restart: always
    ports:
      # Caddy يستمع للمنفذ 80 و 443 (HTTP و HTTPS) على الخادم (الـ VPS)
      - "80:80"   
      - "443:443" 
    volumes:
      # ربط ملف إعداد Caddy (سنقوم بإنشائه في الخطوة التالية)
      - ./Caddyfile:/etc/caddy/Caddyfile 
      # هذا المجلد يحفظ شهادات SSL للحفاظ عليها عند إعادة التشغيل
      - caddy_data:/data 

# تعريف مجلد لحفظ بيانات Caddy (شهادات SSL)
volumes:
  - ./caddyfile:/etc/caddy/Caddyfile # استخدام caddyfile بدلاً من Caddyfile
  - caddy_data:/data