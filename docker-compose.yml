version: '3.7'

services:
  nextjs-app:
    # يخبر Docker Compose أن يقوم بالبناء باستخدام الـ Dockerfile الموجود في نفس المجلد (.).
    build: .
    restart: always
    
  caddy:
    image: caddy:2-alpine
    restart: always
    ports:
      # Caddy يستمع للمنفذ 80 و 443 (HTTP و HTTPS) على الخادم (الـ VPS)
      - "80:80"   
      - "443:443" 
    volumes:
      # ربط ملف إعداد Caddy (الملف المحلي ./Caddyfile) بداخل الحاوية
      # تذكر: تأكد من أن اسم الملف في GitHub هو Caddyfile (C كبير)
      - ./Caddyfile:/etc/caddy/Caddyfile 
      # ربط وحدة التخزين الدائمة لشهادات SSL
      - caddy_data:/data 

# تعريف وحدات التخزين (Volumes) المستخدمة في الخدمات الأخرى
volumes:
  caddy_data: {}